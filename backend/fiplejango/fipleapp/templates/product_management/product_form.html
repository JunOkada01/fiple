{% extends 'base.html' %}
{% block title %}商品追加{% endblock %}
{% block content %}
<h4>商品追加</h4>
<br>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <!-- 画像サイズの注意書き -->
    <p id="image-size-notice" class="text-muted" style="display: none;"></p>
    <button type="submit">追加</button>
</form>
<br>
<a href="{% url 'fipleapp:product_list' %}"><h5>戻る</h5></a>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const productOriginSelect = document.getElementById('id_product_origin');
    const noticeParagraph = document.getElementById('image-size-notice');

    async function updateImageSizeNotice() {
        if (!productOriginSelect.value) {
            noticeParagraph.style.display = 'none';
            return;
        }

        try {
            // 商品元IDに基づいてカテゴリ情報を取得
            const response = await fetch(`/api/get_category_position/${productOriginSelect.value}/`);
            const data = await response.json();
            
            let noticeText = '';
            switch(data.category_position) {
                case 'h':
                    noticeText = '頭部の画像は 100x100 ピクセルで登録してください';
                    break;
                case 'u':
                    noticeText = '上半身の画像は 170x140 ピクセルで登録してください';
                    break;
                case 'l':
                    noticeText = '下半身の画像は 170x150 ピクセルで登録してください';
                    break;
                case 'f':
                    noticeText = '足部の画像は 100x80 ピクセルで登録してください';
                    break;
            }

            noticeParagraph.textContent = noticeText;
            noticeParagraph.style.display = 'block';
        } catch (error) {
            console.error('Error fetching category position:', error);
        }
    }

    productOriginSelect.addEventListener('change', updateImageSizeNotice);
});
</script>
{% endblock %}